#
#
# (c) Copyright 2016-2017 Hewlett Packard Enterprise Development LP
# (c) Copyright 2017-2018 SUSE LLC
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
#
# This configuration file includes the default values for Ardana Openstack
# Changes may be made to this file by customers.

[DEFAULT]
debug = <%= @node[:octavia][:debug] %>

[database]
connection = <%= @octavia_db_connection %>

[controller_worker]
amp_active_retries = 40
amp_active_wait_sec = 10
amp_flavor_id = <%= @octavia_nova_flavor_id %>
amp_image_tag = <%= @node[:octavia][:amphora][:image_tag] %>
amp_boot_network_list = <%= @octavia_mgmt_net_id %>
amp_secgroup_list = <%= @octavia_mgmt_sec_group_id %>
client_ca = <%= @node[:octavia][:certs][:cert_path]%><%=@node[:octavia][:certs][:client_ca_cert_path] %>
compute_driver = compute_nova_driver
amphora_driver = amphora_haproxy_rest_driver
network_driver = allowed_address_pairs_driver
loadbalancer_topology = SINGLE
amp_ssh_key_name = "<%= @node[:octavia][:amphora][:keypair]%>"

[haproxy_amphora]
client_cert = <%= @node[:octavia][:certs][:cert_path]%><%=@node[:octavia][:certs][:client_cert_and_key_path] %>
server_ca = <%= @node[:octavia][:certs][:cert_path]%><%=@node[:octavia][:certs][:server_ca_cert_path] %>
key_path = <%= @node[:octavia][:certs][:cert_path]%><%= @node[:octavia][:amphora][:keypair_private_cert]%>
base_path = /var/lib/octavia
base_cert_dir = <%= @node[:octavia][:certs][:cert_path]%>
connection_max_retries = 10
connection_retry_interval = 10

[keystone_authtoken]
auth_version = <%= @octavia_keystone_settings['api_version'] %>
www_authenticate_uri = <%= KeystoneHelper.versioned_service_URL(@octavia_keystone_settings["protocol"],
                                                    @octavia_keystone_settings["public_auth_url"],
                                                    @octavia_keystone_settings["service_port"],
                                                    @octavia_keystone_settings['api_version']) %>
auth_url = <%= KeystoneHelper.versioned_service_URL(@octavia_keystone_settings["protocol"],
                                                    @octavia_keystone_settings["internal_url_host"],
                                                    @octavia_keystone_settings["service_port"],
                                                    @octavia_keystone_settings['api_version']) %>
auth_type = password
project_name = <%= @octavia_keystone_settings['service_tenant'] %>
project_domain_name = Default
user_domain_name = Default
username = <%= @octavia_keystone_settings['service_user'] %>
password =  <%= @octavia_keystone_settings['service_password'] %>
region_name = <%= @octavia_keystone_settings['endpoint_region'] %>

[certificates]
cert_generator = local_cert_generator
cert_manager = barbican_cert_manager
ca_certificate = <%= @node[:octavia][:certs][:cert_path] %><%= @node[:octavia][:certs][:server_ca_cert_path] %>
ca_private_key = <%= @node[:octavia][:certs][:cert_path] %><%= @node[:octavia][:certs][:server_ca_key_path] %>
ca_private_key_passphrase = <%= @node[:octavia][:certs][:passphrase] %>

[service_auth]
auth_version = <%= @octavia_keystone_settings['api_version'] %>
www_authenticate_uri = <%= KeystoneHelper.versioned_service_URL(@octavia_keystone_settings["protocol"],
                                                    @octavia_keystone_settings["public_auth_url"],
                                                    @octavia_keystone_settings["service_port"],
                                                    @octavia_keystone_settings['api_version']) %>
auth_url = <%= KeystoneHelper.versioned_service_URL(@octavia_keystone_settings["protocol"],
                                                    @octavia_keystone_settings["internal_url_host"],
                                                    @octavia_keystone_settings["service_port"],
                                                    @octavia_keystone_settings['api_version']) %>
auth_type = password
project_name = <%= @octavia_keystone_settings['service_project'] %>
project_domain_name = Default
user_domain_name = Default
username = <%= @octavia_keystone_settings['service_user'] %>
password =  <%= @octavia_keystone_settings['service_password'] %>
region_name = <%= @octavia_keystone_settings['endpoint_region'] %>
cafile = /etc/ssl/ca-bundle.pem

[health_manager]
bind_ip = <%= @node[:octavia][:health_manager][:host] %>
bind_port = <%= @node[:octavia][:health_manager][:port] %>
#TODO: List of controller ip and port pairs for the heartbeat receivers. Example 127.0.0.1:5555, 192.168.0.1:5555
controller_ip_port_list = <%= @octavia_healthmanager_hosts %>
heartbeat_key = <%= @node[:octavia][:health_manager][:heartbeat_key] %>
event_streamer_driver = queue_event_streamer
heartbeat_interval = <%= @node[:octavia][:health_manager][:heartbeat_interval] %>
heartbeat_timeout = <%= @node[:octavia][:health_manager][:heartbeat_timeout] %>
health_check_interval = <%= @node[:octavia][:health_manager][:health_check_interval] %>

[barbican]
auth_url = <%= KeystoneHelper.versioned_service_URL(@neutron_keystone_settings["protocol"],
                                                    @neutron_keystone_settings["internal_url_host"],
                                                    @neutron_keystone_settings["service_port"],
                                                    @neutron_keystone_settings['api_version']) %>
admin_project_name = <%= @neutron_keystone_settings['service_tenant'] %>
admin_user = <%= @neutron_keystone_settings['service_user'] %>
admin_password = <%= @neutron_keystone_settings['service_password'] %>
region_name = <%= @neutron_keystone_settings['endpoint_region'] %>
admin_user_domain = <%= @neutron_keystone_settings['admin_domain'] %>
admin_project_domain = <%= @neutron_keystone_settings['admin_domain'] %>
auth_version = <%= @neutron_keystone_settings['api_version'] %>
admin_tenant_name = <%= @neutron_keystone_settings['admin_tenant'] %>
endpoint_type = "internalURL"

[task_flow]
disable_revert = True

### End of File ###
## Do NOT put anything after this line ##
