[DEFAULT]
apic_system_id=<%= node[:neutron][:apic][:system_id] %>

[opflex]
networks = *

[ml2_apic_aim]
apic_name_mapping = use_name
apic_clear_node_profiles = True
enable_aci_routing = True
apic_arp_flooding = True
enable_optimized_metadata = <%= node[:neutron][:apic][:optimized_metadata] %>
enable_optimized_dhcp = <%= node[:neutron][:apic][:optimized_dhcp] %>
apic_provision_infra = True
apic_provision_hostlinks = True
<%  unless @vpc_pairs.nil? -%>
apic_vpc_pairs = <%= @vpc_pairs %>
<% end -%>

[apic_aim_auth]
auth_url = <%= @keystone_settings['internal_auth_url'] %>
auth_plugin = v3password
user_domain_name = <%= @keystone_settings['admin_domain'] %>
project_domain_name = <%= @keystone_settings['admin_domain'] %>
project_name = <%= @keystone_settings['service_tenant'] %>
username = <%= @keystone_settings['service_user'] %>
password = <%= @keystone_settings['service_password'] %>

[group_policy]
policy_drivers = <%= @policy_drivers %>
extension_drivers = <%= @extension_drivers %>

[group_policy_implicit_policy]
# Uncomment this if ever IPV6 needs to be used
# Provide a suitable ip-pool for ipv6
# default_ip_version = 46
default_ip_pool = <%= @default_ip_pool %>


[apic_external_network:<%=node[:neutron][:apic][:ext_net][:name]%>]
preexisting = <%= node[:neutron][:apic][:ext_net][:preexisting] %>
<% unless node[:neutron][:apic][:ext_net][:nat_enabled].nil? -%>
enable_nat = <%= node[:neutron][:apic][:ext_net][:nat_enabled] %>
<% end -%>
external_epg = <%= node[:neutron][:apic][:ext_net][:ext_epg] %>
host_pool_cidr = <%= node[:neutron][:apic][:ext_net][:host_pool_cidr] %>
# Uncomment this if ever IPV6 needs to be used
# [resource_mapping]
# default_ipv6_ra_mode = slaac
# default_ipv6_address_mode = slaac
