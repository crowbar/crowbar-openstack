version: "3"
services:
  oscm-db:
<% if @docker["dockerhub"] == true %>
    image: <%= @docker["organization"]+"/oscm-db:"+@docker["tag"] %>
<% else %>
    image: <%= @docker["host"]+":"+@docker["port"]+"/"+@docker["organization"]+"/oscm-db:"+@docker["tag"] %>
<% end %>
    container_name: oscm-db
    volumes:
      - /docker/data/oscm-db/data:/var/lib/postgresql/data
    ports:
      - 5432:5432

  oscm-core:
<% if @docker["dockerhub"] == true %>
    image: <%= @docker["organization"]+"/oscm-core:"+@docker["tag"] %>
<% else %>
    image: <%= @docker["host"]+":"+@docker["port"]+"/"+@docker["organization"]+"/oscm-core:"+@docker["tag"] %>
<% end %>
    container_name: oscm-core
    env_file: var.env
    environment:
      - JPDA_ADDRESS=8000
      - JPDA_TRANSPORT=dt_socket
    links:
      - oscm-db:oscm-db
    volumes:
      - /docker/config/oscm-core/privkey:/privkey
      - /docker/config/certs:/certs
    ports:
      - 10080:8080
      - 10081:8081

  oscm-app:
<% if @docker["dockerhub"] == true %>
    image: <%= @docker["organization"]+"/oscm-app:"+@docker["tag"] %>
<% else %>
    image: <%= @docker["host"]+":"+@docker["port"]+"/"+@docker["organization"]+"/oscm-app:"+@docker["tag"] %>
<% end %>
    container_name: oscm-app
    env_file: var.env
    environment:
      - JPDA_ADDRESS=8000
      - JPDA_TRANSPORT=dt_socket
    links:
      - oscm-db:oscm-db
    volumes:
      - /docker/config/oscm-app/privkey:/privkey
      - /docker/config/certs:/certs
    ports:
      - 8880:8880
      - 8881:8881

  oscm-birt:
<% if @docker["dockerhub"] == true %>
    image: <%= @docker["organization"]+"/oscm-birt:"+@docker["tag"] %>
<% else %>
    image: <%= @docker["host"]+":"+@docker["port"]+"/"+@docker["organization"]+"/oscm-birt:"+@docker["tag"] %>
<% end %>
    container_name: oscm-birt
    env_file: var.env
    volumes:
      - /docker/config/oscm-birt/privkey:/privkey
      - /docker/config/certs:/certs
    ports:
      - 8181:8181

  oscm-branding:
<% if @docker["dockerhub"] == true %>
    image: <%= @docker["organization"]+"/oscm-branding:"+@docker["tag"] %>
<% else %>
    image: <%= @docker["host"]+":"+@docker["port"]+"/"+@docker["organization"]+"/oscm-branding:"+@docker["tag"] %>
<% end %>
    container_name: oscm-branding
    env_file: var.env
    volumes:
      - /docker/config/brandings:/brandings:ro
      - /docker/config/oscm-branding/privkey:/privkey
      - /docker/config/certs:/certs
    ports:
      - 4443:443
