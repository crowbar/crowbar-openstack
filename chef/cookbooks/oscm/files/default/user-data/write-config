#!/bin/sh

# Writes the configuration parameters passed in by Heat/cloud-init to /etc/heatconfig.

touch /etc/oscm-variables
chmod 400 /etc/oscm-variables

cat > /etc/oscm-variables <<EOF
APP_VOLUME_DEV=$APP_VOLUME_DEV
DB_VOLUME_DEV=$DB_VOLUME_DEV
HTTP_PROXY=$HTTP_PROXY
HTTPS_PROXY=$HTTPS_PROXY
REGISTRY_HOST=$REGISTRY_HOST
REGISTRY_PORT=$REGISTRY_PORT
REGISTRY_USER=$REGISTRY_USER
REGISTRY_PWD=$REGISTRY_PWD
DB_HOSTNAME=db
OSCM_HOSTNAME=web
APP_HOSTNAME=app
KEYSTORE_PASSWORD=$KEYSTORE_PASSWORD
AS_ADMIN_PASSWORD=$AS_ADMIN_PASSWORD
DB_PASSWORD=$DB_PASSWORD
MAIL_ADDRESS=$MAIL_ADDRESS
MAIL_HOST=$MAIL_HOST
MAIL_PASSWORD=$MAIL_PASSWORD
MAIL_USER=$MAIL_USER
MAIL_PORT=$MAIL_PORT
MAIL_AUTH=$MAIL_AUTH
MAIL_TLS=$MAIL_TLS
KEYSTONE_USER_PWD=$KEYSTONE_USER_PWD
KEYSTONE_USER_NAME=$KEYSTONE_USER_NAME
KEYSTONE_URL=$KEYSTONE_URL
KEYSTONE_TENANT_ID=$KEYSTONE_TENANT_ID
OSCM_IMAGE_NAME=$OSCM_IMAGE_NAME
APP_IMAGE_NAME=$APP_IMAGE_NAME
DB_IMAGE_NAME=$DB_IMAGE_NAME
SSL_PATH=$SSL_PATH
WAIT_CURL="$WAIT_CURL"
EOF

CERT_STR="$SSH_CERT"
echo $CERT_STR >> /root/.ssh/authorized_keys