- register_javascripts "barclamps/neutron/form"

= attributes_for @proposal do
  .panel-sub
    = header @dep_raw, true

  .panel-body
    = instance_field :database
    = instance_field :keystone
    = instance_field :rabbitmq
    = string_field :dhcp_domain

    %fieldset
      %legend
        = t(".plugin_header")

      = select_field :networking_plugin, :collection => :networking_plugins_for_neutron

      #mode_container
        = select_field :networking_mode, :collection => :networking_modes_for_neutron

        .alert.alert-warning#warn_ovs_vlan
          = t(".warn_ovs_vlan")

    #cisco_switches
      %fieldset
        %legend
          = t(".cisco_switches")

        %table.table.table-middle{ "data-dynamic" => "#switch-entries", "data-namespace" => "cisco_switches", "data-optional" => "", "data-invalid" => t(".error_invalid"), "data-duplicate" => t(".error_duplicate") }
          %thead
            %tr
              %th.col-sm-3
                = t(".switch_ip")
              %th.col-sm-2
                = t(".switch_port")
              %th.col-sm-3
                = t(".switch_user")
              %th.col-sm-3
                = t(".switch_password")
              %th.col-sm-1
          %tbody
          %tfoot
            %tr
              %th
                = text_field_tag "switch[name]", "", :placeholder => t(".switch_ip"), :class => "form-control", "data-name" => "name", "data-type" => "string"
              %th
                = number_field_tag "switch[port]", "", :placeholder => t(".switch_port"), :class => "form-control", "data-name" => "port", "data-type" => "string"
              %th
                = text_field_tag "switch[user]", "", :placeholder => t(".switch_user"), :class => "form-control", "data-name" => "user", "data-type" => "string"
              %th
                = password_field_tag "switch[password]", "", :placeholder => t(".switch_password"), :class => "form-control", "data-name" => "password", "data-type" => "string"
              %th
                = link_to t(".add_switch"), "#", :class => "btn btn-default btn-block", "data-add" => true

    #cisco_ports
      %fieldset
        %legend
          = t(".cisco_ports")

        %table.table.table-middle
          %thead
            %tr
              %th.col-sm-5
                = t(".port_node")
              %th.col-sm-3
                = t(".port_switch")
              %th.col-sm-3
                = t(".port_number")
              %th.col-sm-1
          %tbody
            - if nodes_by_role("nova-multi-compute-*").empty?
              %tr
                %td{ :colspan => 4 }
                  .empty.alert.alert-info.text-center
                    = t(".no_nodes")
            - else
              - compute_nodes.each do |node|
                %tr.edit
                  %td
                    = text_field_tag "port[node]", node.alias, :placeholder => t(".port_node"), :class => "form-control", :disabled => "disabled"
                  %td
                    = select_tag "port[switch]", "", :placeholder => t(".port_switch"), :class => "form-control", "data-node" => node.handle, "data-name" => "switch"
                  %td
                    = text_field_tag "port[number]", "", :placeholder => t(".port_number"), :class => "form-control", "data-node" => node.handle, "data-name" => "number"
                  %td
                    = link_to t(".clear_port"), "#", :class => "btn btn-default btn-block", "data-clear" => node.handle

    %fieldset
      %legend
        = t(".ssl_header")

      = select_field %w(api protocol), :collection => :api_protocols_for_neutron, "data-sslprefix" => "ssl", "data-sslcert" => "/etc/neutron/ssl/certs/signing_cert.pem", "data-sslkey" => "/etc/neutron/ssl/private/signing_key.pem"

      #ssl_container
        = boolean_field %w(ssl generate_certs)
        = string_field %w(ssl certfile)
        = string_field %w(ssl keyfile)
        = boolean_field %w(ssl insecure)
        = boolean_field %w(ssl cert_required), "data-enabler" => "true", "data-enabler-target" => "#ssl_ca_certs"
        = string_field %w(ssl ca_certs)

    = render "barclamp/git/pfsdeps"

%script#switch-entries{ :type => "text/x-handlebars-template" }
  {{#each entries}}
  %tr.edit
    %td
      = text_field_tag "switch[name]", "{{name}}", :placeholder => t(".switch_ip"), :class => "form-control", :disabled => "disabled"
    %td
      = number_field_tag "switch[port]", "{{port}}", :placeholder => t(".switch_port"), :class => "form-control", "data-update" => "exports/{{name}}/port", "data-type" => "string"
    %td
      = text_field_tag "switch[user]", "{{user}}", :placeholder => t(".switch_user"), :class => "form-control", "data-update" => "exports/{{name}}/user", "data-type" => "string"
    %td
      = password_field_tag "switch[password]", "{{password}}", :placeholder => t(".switch_password"), :class => "form-control", "data-update" => "exports/{{name}}/password", "data-type" => "string"
    %td
      = link_to t(".remove_switch"), "#", :class => "btn btn-default btn-block", "data-remove" => "{{name}}"
  {{else}}
  %tr
    %td{ :colspan => 5 }
      .empty.alert.alert-info.text-center
        = t(".no_switches")
  {{/each}}
